# 視覚化最適化ガイド

データを直感的に理解できるダッシュボードを実現するために、視線誘導の階層設計と適切なチャート選択、凡例・軸・色の統一ルールを整理する。

## 1. 主要グラフタイプと読み取りメッセージ

| タブ | グラフ | 推奨チャート型 | 読み取りメッセージ / 使用目的 |
| --- | --- | --- | --- |
| 売上 | 売上トレンド | 折れ線グラフ（Line chart） | 時系列で売上の増減を追跡する。ピークと谷、トレンドの方向を示し、季節性やキャンペーン効果を把握する。 |
|  | 商品別売上 | 縦棒グラフ（Bar chart） | 商品別の売上規模を比較し、売れ筋／不振商品を特定する。カテゴリ数が多い場合は上位10件に絞る。 |
|  | チャネル別売上 | 横棒グラフ（Horizontal bar chart） | オンライン／店舗／電話注文等チャネル毎の構成比を比較する。チャネル名が長くても視認しやすい。 |
|  | 店舗別売上 | 縦棒グラフ | 複数店舗の売上を比較する。平均線や目標線を追加して達成状況を示す。 |
| 粗利 | 粗利トレンド | 面グラフ（Area chart） | 売上と原価差額の推移を面で表し、粗利の増減や季節性を視覚的に把握する。売上・原価を重ね描きして粗利幅の大きさを直感的に示す。 |
|  | 商品別粗利 | 縦棒グラフ | 商品別の粗利益額・粗利率を比較し、高粗利商品に焦点を当てる。バーの色は粗利率に応じたグラデーションにする。 |
| 在庫 | 在庫残数推移 | 折れ線グラフ | 期間内の在庫推移を示し、在庫切れリスクや過剰在庫を発見する。安全在庫水準を補助線で表示する。 |
|  | カテゴリ別在庫 | 横棒グラフ | カテゴリごとの在庫量を比較し、偏りや不足カテゴリを特定する。色で在庫状況（不足／適正／過剰）を表す。 |
|  | 在庫回転率 | 折れ線グラフ | 各月の回転率を示し、在庫効率の改善状況を追跡する。目標値は点線で表示する。 |
| 資金 | 現預金トレンド | 折れ線グラフ | 現預金残高の推移を示し、資金ショートのリスクを早期に把握する。 |
|  | 入金と支出 | グループ化棒グラフ（Grouped bar chart） | 月別の入金額と支出額を並置して比較し、キャッシュフローのバランスを可視化する。 |
|  | キャッシュフロー構成 | 縦棒グラフ | 入金・支出の構成比（売上、金融収支、人件費、その他）を表し、支出構造の見直しに活かす。 |

### 棒／折／面グラフの原則
- 数量比較や時系列トレンドには棒グラフまたは折れ線グラフを使用し、円グラフは使用しない。
- 面グラフは売上と原価の差のように累積量を示すときのみ利用する。

## 2. 凡例・軸・単位の統一ルール
- **軸タイトル**: すべてのグラフで「x軸: 期間」「y軸: 指標名」を明記し、単位（円・個・%など）を付与する。例: `x軸: 月`, `y軸: 売上 (円)`。
- **数値表記**: 数値は 3 桁ごとのカンマ区切りとし、通貨・数量・割合の単位をラベルに含める。
- **軸範囲**: 数値軸は 0 を起点とし、比較が歪まないようにする。売上や在庫など常に正の指標は 0 始まりを固定する。
- **目盛設計**: メジャー目盛は 5～7 本以内に抑え、読みやすい間隔を設定する。日次データは月単位に集約して表示し、過度な目盛を避ける。
- **凡例配置**: 複数系列を表示する場合、凡例はグラフ上部または右側に配置し、系列名と色を対応させる。最大 4 系列までとし、それ以上はフィルタやチェックボックスで絞り込む。
- **色使い**: `color.accent`（青系）を売上やプラスの変化に、`color.error`（赤系）を原価やマイナス変化に、`color.secondary`（グレー）を基準線・目標線に用いる。強調したい系列は彩度を高め、その他は淡色で描画する。
- **数値ラベル**: KPIカードやチャート上のデータラベルは最大値・最小値・最新値など重要ポイントに限定し、情報過多を避ける。

## 3. 読み取り支援メッセージとツールチップ
- 各グラフには「何を読み取るべきか」を示すキャプションを添える。例:
  - **売上トレンド**: 「今月の売上は先月比 +12% で、8月に比べ大幅に増加。週次では第2週が最も高く、キャンペーン効果が確認できる。」
  - **商品別売上**: 「上位 3 商品で総売上の 60% を占め、商品Aは前年同期比 +20% の伸び。」
  - **在庫残数推移**: 「先月末に在庫が急減し、安全在庫水準を下回った期間あり。発注リードタイムを考慮した補充が必要。」
  - **現預金トレンド**: 「現預金残高は今月末で ¥3,500,000、前年同月比 +8%。来月末の税支払を踏まえて予備資金の確保が必要。」
- ツールチップ（Hover 情報）には日付、値、前年同日比などの詳細を表示し、ポイントにカーソルを置くだけで深掘りできるようにする。
- 主要ポイントにはアイコン（例: `⬆` `⚠`）を用いた注釈を追加し、視線誘導を補助する。

## 4. 実装上の注意点
- Streamlit では `st.line_chart` / `st.bar_chart` よりも **Plotly** や **Altair** を利用し、凡例位置・色指定・ツールチップ設定を柔軟に制御する。
- グラフごとに描画関数を作成し、データフレームとフィルタ条件を引数として受け取ることで再利用性を高める。
- `st.empty()` と `with` ステートメントでコンテナを保持し、データ更新時の点滅を防ぐ。`st.session_state` と組み合わせて期間・店舗などの選択状態を維持する。
- 安全在庫線や目標線などの補助線は `color.secondary` を使用し、凡例に明記する。
- 期間切替やカテゴリフィルタは `st.segmented_control` など一貫した UI コンポーネントで提供し、グラフとの距離を 16px 以内に保って視線移動を短縮する。

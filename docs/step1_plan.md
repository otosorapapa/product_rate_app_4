# ステップ1: 要件定義とユーザーストーリー

## 背景と目的
- アプリの目的は、業種・従業員区分ごとの標準賃率を算出し、実際賃率との差異分析や見積原価の算定を支援すること。
- 標準賃率は一般に「標準作業時間 × 標準賃率（時間当たり賃金）」で求め、差異分析では実際データとの比較から賃率差異・効率差異などを導出する。
- 特に建設業やサービス業など、技能レベル別に複数の人件費水準を管理する事業者が主な利用者像。

## 機能要件
### 入力データ
1. **従業員区分情報**
   - 例: 技能者 / 半技能者 / 非技能者、正社員 / パートタイムなど。
   - 各区分の人員数や適用予定シフトを入力できること。
2. **標準作業時間**
   - 製品1単位またはサービス1回当たりの標準所要時間。
   - 区分別に異なる時間を登録できること。
3. **実績データ（差異分析用）**
   - 実際作業時間、実際賃率、実際発生賃金額。
   - 期間フィルタ（例: 月次、案件単位）での入力・切替に対応すること。
4. **外部基準**
   - 業界標準賃率、地域別最低賃金、労使協定賃金表など参照値を入力。
   - インポート機能（CSV / Excel）で外部基準を取り込めるよう検討。
5. **間接費・法定福利費などの付加率**
   - 法定福利費率、労務関連の共通間接費率、希望する利益率を設定。
   - 設定値はプロジェクトごと・組織全体で上書き可能にする。
6. **業種別テンプレートとフェルミ推定初期値**
   - 製造業、食品加工業、サービス業など主要業種を想定したテンプレートを複数用意する。
   - テンプレートには年間稼働日数236日、1日当たり稼働時間8.68時間、固定費5,711万円といった一般的なフェルミ推定値を含め、ユーザーが自社実績と比較して調整できるようにする。
   - 入力テンプレートの標準化により、初回利用時の心理的ハードルを下げる。

### データ取込と品質チェック
- サンプルデータ読み込み後に発生するエラー・警告をレベル（致命的／注意）ごとに色分けして表示する。
- 各エラー行から「入力すべき列」へのリンクを設け、クリックで対象カラムがハイライトされるようにする。
- 修正方法のガイドをポップアップで提示し、何を修正すべきか即座に理解できるようにする。
- Streamlitの編集機能を活用し、Excelへ戻らなくてもアプリ内で直接セル編集と保存ができるインライン編集機能を提供する。

### UX／ガイダンス要件
- 専門用語（例: 「必要賃率」「ブレークイーブン賃率」「付加価値」）にはツールチップを設定し、その場で簡易説明が読めるようにする。
- ツールチップ内に用語集ページへのリンクを配置し、詳細説明へワンクリックで遷移できるようにする。
- 初めての利用者でも迷わないよう、入力画面に「ヘルプ」導線を常時表示する。

### 出力と計算要件
- 従業員区分別の標準賃率（時間当たり／単位当たり）の算出。
- 実績データとの比較による賃率差異・効率差異・総差異の表示。
- 外部基準との比較（例: 最低賃金を下回っていないか）アラート表示。
- 間接費や利益率を加味した見積賃率・必要販売単価の試算。
- 期間・プロジェクト・区分でフィルタリングおよびレポート出力。

### 非機能要件（初期案）
- **操作性**: Streamlit UIで直感的に入力・結果確認が行え、インライン編集や色分け表示で迷わず修正できること。
- **データ保持**: 設定値・実績値をローカルファイル（例: Excel/CSV）または将来的なDBに保存できる拡張性。
- **再現性**: 同じ入力条件で同じ標準賃率が再計算できること（計算ロジックのテスト整備）。
- **アクセシビリティ**: ツールチップやヘルプ導線がキーボード操作でも利用できること。

## ユーザーストーリー
### 建設業経営者Aさん
- **状況**: 技能者3名を抱える工務店の経営者。案件ごとに見積用の標準賃率を設定したい。
- **課題**: 現在はExcelで個別に計算しており、外部基準や法定福利費を加味し忘れることがある。
- **目的**: 標準賃率と見積賃率を一括で算出し、案件見積に反映したい。
- **必要機能**:
  - 従業員区分別に標準作業時間と標準賃率を入力。
  - 法定福利費率・利益率を上乗せした見積賃率を自動計算。
  - 実績工数を入力し、賃率差異や効率差異を確認。
  - 案件ごとのレポートをエクスポート（Excel / PDF）。

### カフェ経営者Bさん
- **状況**: パート・アルバイト従業員を複数雇用し、シフトごとに実際賃率が変動する。
- **課題**: 最低賃金や地域の相場を踏まえた適正な標準賃率を定期的に再設定したい。
- **目的**: 半期ごとに標準賃率を見直し、実績との乖離を可視化することで人件費の健全化を図る。
- **必要機能**:
  - 外部基準（最低賃金・業界平均）を取り込み、自社賃率と比較。
  - 従業員区分ごとにシフト実績の賃率・工数を入力し、差異を可視化。
  - 期間（週次・月次）でフィルタしたレポートをダッシュボード表示。
  - 差異が閾値を超えた場合のアラート通知（メール送信やダッシュボード上の強調表示）。

## 今後の検討課題
- 業種別テンプレートに対するA/Bテストやユーザーヒアリングを通じたフェルミ推定値のチューニング。
- 既存人事・生産管理システムとのAPI連携によるデータ自動取込の拡大。
- 複数プロジェクト・複数拠点を管理する際の集計ロジック。
- 将来的な機能拡張（例: モバイル対応、ダッシュボードのカスタマイズ、AIによる賃率予測など）。
